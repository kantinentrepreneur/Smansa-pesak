<!DOCTYPE html>
<html lang="id">
<head>
    <!-- ============================================
         1. FIREBASE SDK (PALING ATAS)
         ============================================ -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    
    <script>
        // GANTI INI DENGAN DATA DARI FIREBASE CONSOLE ANDA
        const firebaseConfig = {
            apiKey: "AIzaSyBQgDXOLtINJ2RLXzLqpXFY...", // GANTI
            authDomain: "kantin-smansa.firebaseapp.com",
            databaseURL: "https://kantin-smansa-default-rtdb.asia-southeast1.firebasedatabase.app/", // GANTI
            projectId: "kantin-smansa",
            storageBucket: "kantin-smansa.appspot.com",
            messagingSenderId: "897377252341",
            appId: "1:897377252341:web:b92c55a3ee..." // GANTI
        };
        
        // NYALAKAN FIREBASE
        firebase.initializeApp(firebaseConfig);
        const DB = firebase.database();
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kantin Smansa - Realtime</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #FF6B35;
            --primary-dark: #E85D04;
            --primary-light: #FFF5F0;
            --success: #2ECC71;
            --dark: #2C3E50;
            --gray: #95A5A6;
            --white: #FFFFFF;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --radius: 16px;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #FFF5F0 0%, #FFE8E0 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            background: var(--white);
            min-height: 100vh;
            box-shadow: var(--shadow);
        }
        
        .hidden { display: none !important; }
        
        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 30px 20px;
            border-radius: 0 0 30px 30px;
            color: var(--white);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            line-height: 1.3;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
            margin-top: 8px;
        }
        
        /* ROLE CARDS */
        .role-section {
            padding: 30px 20px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .role-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .role-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }
        
        .role-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }
        
        .role-icon.buyer { background: #E3F2FD; }
        .role-icon.seller { background: #FFF3E0; }
        
        .role-info h3 {
            font-size: 18px;
            font-weight: 700;
        }
        
        .role-info p {
            font-size: 13px;
            color: var(--gray);
        }
        
        .role-arrow {
            margin-left: auto;
            font-size: 24px;
            color: var(--primary);
        }
        
        /* FORMS */
        .form-container {
            padding: 20px;
            min-height: 100vh;
        }
        
        .btn-back {
            background: var(--white);
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-illustration {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            background: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
        }
        
        .form-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .form-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .input-hint {
            font-size: 12px;
            color: var(--gray);
            margin-top: 6px;
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
        }
        
        .error-message {
            background: #FFEBEE;
            color: #C62828;
            padding: 12px;
            border-radius: 12px;
            font-size: 14px;
            margin-bottom: 16px;
            display: none;
            align-items: center;
            gap: 8px;
        }
        
        /* DASHBOARD */
        .dashboard {
            background: #F8F9FA;
            min-height: 100vh;
            padding-bottom: 100px;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px;
            color: var(--white);
            border-radius: 0 0 30px 30px;
        }
        
        .dashboard-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .user-info h3 {
            font-size: 20px;
            font-weight: 700;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: var(--white);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.15);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: 800;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .dashboard-content {
            padding: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title-sm {
            font-size: 18px;
            font-weight: 700;
        }
        
        .add-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: var(--primary);
            color: var(--white);
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        
        /* CARDS */
        .menu-card, .order-card, .food-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
        }
        
        .menu-card {
            display: flex;
            gap: 16px;
        }
        
        .menu-image {
            width: 80px;
            height: 80px;
            background: var(--primary-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        .menu-details { flex: 1; }
        
        .menu-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .menu-price {
            color: var(--primary);
            font-weight: 800;
            font-size: 18px;
        }
        
        .menu-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .btn-icon {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .btn-edit { background: #E3F2FD; color: #1976D2; }
        .btn-delete { background: #FFEBEE; color: #C62828; }
        
        /* ORDER CARD */
        .order-card {
            border-left: 4px solid var(--primary);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .order-customer h4 {
            font-size: 16px;
            font-weight: 700;
        }
        
        .customer-phone {
            font-size: 13px;
            color: var(--primary);
            font-weight: 600;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
        }
        
        .status-pending { background: #FFF3E0; color: #E65100; }
        .status-process { background: #E3F2FD; color: #1565C0; }
        .status-done { background: #E8F5E9; color: #2E7D32; }
        
        .order-items {
            background: #FAFAFA;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 14px;
            border-bottom: 1px dashed #E0E0E0;
        }
        
        .order-total {
            font-size: 20px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 12px;
        }
        
        .order-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-action {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
        }
        
        .btn-accept { background: var(--success); color: var(--white); }
        .btn-process { background: var(--primary); color: var(--white); }
        .btn-chat {
            background: #25D366;
            color: var(--white);
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* BUYER VIEW */
        .search-bar {
            background: var(--white);
            border-radius: 12px;
            padding: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .search-bar input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 15px;
        }
        
        .category-pills {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        .category-pill {
            padding: 10px 20px;
            background: var(--white);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            box-shadow: var(--shadow);
        }
        
        .category-pill.active {
            background: var(--primary);
            color: var(--white);
        }
        
        .food-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .food-card { overflow: hidden; padding: 0; }
        
        .food-image {
            height: 120px;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }
        
        .food-info { padding: 16px; }
        
        .food-name {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .food-price {
            color: var(--primary);
            font-weight: 800;
            margin-bottom: 8px;
        }
        
        .add-to-cart {
            width: 100%;
            padding: 10px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #F5F5F5;
            border-radius: 8px;
            padding: 4px;
        }
        
        .qty-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--white);
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
        }
        
        /* CART BAR */
        .cart-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            width: 100%;
            max-width: 480px;
            background: var(--white);
            padding: 16px 20px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.15);
            border-radius: 24px 24px 0 0;
            transition: transform 0.3s ease;
        }
        
        .cart-bar.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .cart-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .cart-total {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
        }
        
        /* MODAL */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 200;
            align-items: flex-end;
            justify-content: center;
        }
        
        .modal-overlay.show {
            display: flex;
        }
        
        .modal-content {
            background: var(--white);
            width: 100%;
            max-width: 480px;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-close {
            width: 40px;
            height: 40px;
            border: none;
            background: #F5F5F5;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
        }
        
        .summary-box {
            background: var(--primary-light);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .seller-info-box {
            background: #E8F5E9;
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .seller-info-box .icon {
            width: 40px;
            height: 40px;
            background: var(--success);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
        
        .empty-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        /* NOTIFICATION */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--dark);
            color: var(--white);
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- NOTIFICATION -->
        <div id="notification" class="notification"></div>

        <!-- ============================================
             LANDING PAGE
             ============================================ -->
        <div id="landingPage" class="page">
            <div class="header">
                <div class="logo">
                    <span>üçΩÔ∏è</span>
                    <span>Kantin Smansa</span>
                </div>
                <h1>Pesan Makanan Favoritmu!</h1>
                <p>Tanpa antri, langsung dimasak & diantar</p>
            </div>

            <div class="role-section">
                <h2 class="section-title">Masuk sebagai</h2>
                
                <div class="role-card" onclick="showPage('buyerHome')">
                    <div class="role-icon buyer">üéì</div>
                    <div class="role-info">
                        <h3>Siswa / Pembeli</h3>
                        <p>Pesan makanan & tracking</p>
                    </div>
                    <div class="role-arrow">‚Ä∫</div>
                </div>

                <div class="role-card" onclick="showPage('sellerLogin')">
                    <div class="role-icon seller">üë®‚Äçüç≥</div>
                    <div class="role-info">
                        <h3>Penjual Kantin</h3>
                        <p>Kelola menu & proses pesanan</p>
                    </div>
                    <div class="role-arrow">‚Ä∫</div>
                </div>
            </div>
        </div>

        <!-- ============================================
             SELLER LOGIN
             ============================================ -->
        <div id="sellerLogin" class="page hidden">
            <div class="form-container">
                <button class="btn-back" onclick="showPage('landingPage')">‚Üê Kembali</button>
                
                <div class="form-header">
                    <div class="form-illustration">üë®‚Äçüç≥</div>
                    <h2>Login Penjual</h2>
                </div>

                <div class="form-card">
                    <div id="loginError" class="error-message">
                        <span>‚ö†Ô∏è</span>
                        <span>Password salah!</span>
                    </div>

                    <form onsubmit="return doLogin(event)">
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" id="sellerPassword" class="form-input" placeholder="Masukkan password" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Nomor WhatsApp</label>
                            <input type="tel" id="sellerWA" class="form-input" placeholder="6289612345678" required>
                            <p class="input-hint">Format: 62 + nomor tanpa 0</p>
                        </div>

                        <button type="submit" class="btn btn-primary">Masuk Dashboard</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ============================================
             SELLER DASHBOARD
             ============================================ -->
        <div id="sellerDashboard" class="page hidden dashboard">
            <div class="dashboard-header">
                <div class="dashboard-top">
                    <div class="user-info">
                        <h3>üë®‚Äçüç≥ Mode Penjual</h3>
                        <p id="sellerWADisplay">WA: -</p>
                    </div>
                    <button class="logout-btn" onclick="doLogout()">Logout</button>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="statMenu">0</div>
                        <div class="stat-label">Menu</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statOrders">0</div>
                        <div class="stat-label">Pesanan</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statPending">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-content">
                <div class="section-header">
                    <h3 class="section-title-sm">üìã Menu Saya</h3>
                    <button class="add-btn" onclick="openMenuModal()">+</button>
                </div>
                <div id="sellerMenuList">
                    <div class="empty-state">
                        <div class="empty-icon">üçΩÔ∏è</div>
                        <div class="empty-title">Belum ada menu</div>
                    </div>
                </div>

                <div class="section-header" style="margin-top: 30px;">
                    <h3 class="section-title-sm">üì¶ Pesanan Masuk</h3>
                </div>
                <div id="orderList">
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <div class="empty-title">Belum ada pesanan</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             BUYER HOME
             ============================================ -->
        <div id="buyerHome" class="page hidden dashboard">
            <div class="dashboard-header">
                <div class="dashboard-top">
                    <div class="user-info">
                        <h3>üéì Selamat Datang!</h3>
                        <p>Pesan makanan favoritmu</p>
                    </div>
                </div>
                <div class="search-bar">
                    <span>üîç</span>
                    <input type="text" placeholder="Cari makanan..." id="searchFood" onkeyup="searchMenu()">
                </div>
            </div>

            <div class="dashboard-content">
                <div class="category-pills">
                    <div class="category-pill active" onclick="filterCategory('all', this)">Semua</div>
                    <div class="category-pill" onclick="filterCategory('food', this)">Makanan</div>
                    <div class="category-pill" onclick="filterCategory('drink', this)">Minuman</div>
                    <div class="category-pill" onclick="filterCategory('snack', this)">Snack</div>
                </div>

                <div id="buyerMenuList" class="food-grid">
                    <div class="empty-state">
                        <div class="empty-icon">üçΩÔ∏è</div>
                        <div class="empty-title">Menu belum tersedia</div>
                    </div>
                </div>
            </div>

            <!-- CART BAR -->
            <div id="cartBar" class="cart-bar">
                <div class="cart-info">
                    <span><span id="cartItemCount">0</span> item</span>
                    <span class="cart-total">Rp <span id="cartTotal">0</span></span>
                </div>
                <button class="btn btn-primary" onclick="openCheckoutModal()">Lanjutkan Pesanan ‚Üí</button>
            </div>
        </div>

        <!-- ============================================
             CHECKOUT MODAL
             ============================================ -->
        <div id="checkoutModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Checkout</h3>
                    <button class="modal-close" onclick="closeCheckoutModal()">√ó</button>
                </div>

                <form onsubmit="return submitOrder(event)">
                    <div class="form-group">
                        <label class="form-label">Nama Lengkap</label>
                        <input type="text" id="buyerName" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Kelas / Lokasi</label>
                        <input type="text" id="buyerClass" class="form-input" required>
                    </div>

                    <!-- INPUT WHATSAPP PEMBELI - PENTING! -->
                    <div class="form-group">
                        <label class="form-label">Nomor WhatsApp</label>
                        <input type="tel" id="buyerPhone" class="form-input" placeholder="6289612345678" required>
                        <p class="input-hint">Untuk dihubungi penjual</p>
                    </div>

                    <div class="summary-box">
                        <strong>Ringkasan Pesanan:</strong>
                        <div id="checkoutItems" style="margin: 10px 0;"></div>
                        <div style="font-size: 20px; font-weight: 800; color: var(--primary);">
                            Total: Rp <span id="checkoutTotal">0</span>
                        </div>
                    </div>

                    <div id="checkoutSellerInfo" class="seller-info-box" style="display: none;">
                        <div class="icon">üì±</div>
                        <div>
                            <div style="font-size: 12px; color: #666;">Pesanan ke:</div>
                            <div style="font-weight: 700;" id="checkoutSellerWA">-</div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">üì± Pesan via WhatsApp</button>
                </form>
            </div>
        </div>

        <!-- ============================================
             MENU MODAL (SELLER)
             ============================================ -->
        <div id="menuModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="menuModalTitle">Tambah Menu</h3>
                    <button class="modal-close" onclick="closeMenuModal()">√ó</button>
                </div>

                <form onsubmit="return saveMenu(event)">
                    <input type="hidden" id="editMenuId">
                    
                    <div class="form-group">
                        <label class="form-label">Nama Makanan</label>
                        <input type="text" id="menuName" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Harga (Rp)</label>
                        <input type="number" id="menuPrice" class="form-input" required min="1000">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Kategori</label>
                        <select id="menuCategory" class="form-input">
                            <option value="food">üçõ Makanan</option>
                            <option value="drink">ü•§ Minuman</option>
                            <option value="snack">üçø Snack</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Estimasi Waktu (menit)</label>
                        <input type="number" id="menuTime" class="form-input" required min="1">
                    </div>

                    <button type="submit" class="btn btn-primary" id="btnSaveMenu">Simpan Menu</button>
                </form>
            </div>
        </div>
    </div>

    <!-- ============================================
         JAVASCRIPT + FIREBASE
         ============================================ -->
    <script>
        // KONFIGURASI
        const CONFIG = {
            SELLER_PASSWORD: 'smansa2024'
        };

        const EMOJIS = {
            food: 'üçõ',
            drink: 'ü•§',
            snack: 'üçø'
        };

        // STATE
        let state = {
            menu: [],
            orders: [],
            cart: [],
            sellerWA: '',
            isSellerLoggedIn: false
        };

        // ==========================================
        // FIREBASE REALTIME - INISIALISASI
        // ==========================================
        
        function initFirebase() {
            // Listen menu (realtime)
            DB.ref('menu').on('value', (snapshot) => {
                state.menu = snapshot.val() || [];
                console.log('üìã Menu updated:', state.menu.length);
                
                if (document.getElementById('buyerHome').classList.contains('active')) {
                    updateBuyerView();
                }
                if (document.getElementById('sellerDashboard').classList.contains('active')) {
                    renderMenuList();
                    updateStats();
                }
            });

            // Listen orders (realtime)
            DB.ref('orders').on('value', (snapshot) => {
                state.orders = snapshot.val() || [];
                console.log('üì¶ Orders updated:', state.orders.length);
                
                if (document.getElementById('sellerDashboard').classList.contains('active')) {
                    renderOrderList();
                    updateStats();
                }
            });
        }

        // ==========================================
        // NAVIGATION
        // ==========================================
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            
            if (pageId === 'sellerDashboard') {
                updateSellerView();
            } else if (pageId === 'buyerHome') {
                updateBuyerView();
            }
        }

        // ==========================================
        // SELLER AUTH
        // ==========================================
        
        function doLogin(e) {
            e.preventDefault();
            
            const password = document.getElementById('sellerPassword').value;
            const wa = document.getElementById('sellerWA').value.trim();
            
            if (password !== CONFIG.SELLER_PASSWORD) {
                showError('loginError', 'Password salah!');
                return false;
            }
            
            state.sellerWA = wa;
            state.isSellerLoggedIn = true;
            
            // Simpan ke local (device ini saja)
            localStorage.setItem('sellerWA', wa);
            localStorage.setItem('sellerLoggedIn', 'true');
            
            // Simpan ke Firebase (agar pembeli tahu nomor penjual)
            DB.ref('sellerWA').set(wa);
            
            showNotification('‚úÖ Login berhasil!');
            showPage('sellerDashboard');
            return false;
        }

        function doLogout() {
            localStorage.removeItem('sellerLoggedIn');
            state.isSellerLoggedIn = false;
            showNotification('üëã Logout berhasil');
            showPage('landingPage');
        }

        // ==========================================
        // SELLER DASHBOARD
        // ==========================================
        
        function updateSellerView() {
            document.getElementById('sellerWADisplay').textContent = 'WA: ' + state.sellerWA;
            renderMenuList();
            renderOrderList();
            updateStats();
        }

        function updateStats() {
            document.getElementById('statMenu').textContent = state.menu.length;
            document.getElementById('statOrders').textContent = state.orders.length;
            document.getElementById('statPending').textContent = state.orders.filter(o => o.status === 'pending').length;
        }

        function renderMenuList() {
            const container = document.getElementById('sellerMenuList');
            
            if (state.menu.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üçΩÔ∏è</div>
                        <div class="empty-title">Belum ada menu</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = state.menu.map(menu => `
                <div class="menu-card">
                    <div class="menu-image">${menu.emoji || EMOJIS[menu.category]}</div>
                    <div class="menu-details">
                        <div class="menu-name">${menu.name}</div>
                        <div class="menu-price">Rp ${menu.price.toLocaleString()}</div>
                        <div style="font-size: 12px; color: var(--gray);">‚è±Ô∏è ${menu.time} menit</div>
                        <div class="menu-actions">
                            <button class="btn-icon btn-edit" onclick="editMenu('${menu.id}')">‚úèÔ∏è</button>
                            <button class="btn-icon btn-delete" onclick="deleteMenu('${menu.id}')">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderOrderList() {
            const container = document.getElementById('orderList');
            const pending = state.orders.filter(o => o.status !== 'done').reverse();
            
            if (pending.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <div class="empty-title">Belum ada pesanan</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = pending.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-customer">
                            <h4>${order.buyer}</h4>
                            <div class="customer-phone">üì± ${order.buyerPhone}</div>
                            <p style="font-size: 13px; color: var(--gray);">${order.class}</p>
                        </div>
                        <span class="status-badge status-${order.status}">${getStatusLabel(order.status)}</span>
                    </div>
                    <div class="order-items">
                        ${order.items.map(item => `
                            <div class="order-item">
                                <span>${item.emoji || EMOJIS[item.category]} ${item.name} x${item.qty}</span>
                                <span>Rp ${(item.price * item.qty).toLocaleString()}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="order-total">Rp ${order.total.toLocaleString()}</div>
                    <div class="order-actions">
                        ${order.status === 'pending' 
                            ? `<button class="btn-action btn-accept" onclick="updateOrderStatus('${order.id}', 'process')">‚úÖ Terima</button>`
                            : `<button class="btn-action btn-process" onclick="updateOrderStatus('${order.id}', 'done')">üöö Selesai</button>`
                        }
                        <a href="https://wa.me/${order.buyerPhone}?text=${encodeURIComponent(`Halo ${order.buyer}, pesanan kamu sedang ${getStatusLabel(order.status)}`)}" 
                           target="_blank" class="btn-action btn-chat">üí¨ Chat</a>
                    </div>
                </div>
            `).join('');
        }

        // ==========================================
        // MENU CRUD
        // ==========================================
        
        function openMenuModal() {
            document.getElementById('menuModal').classList.add('show');
            document.getElementById('menuModalTitle').textContent = 'Tambah Menu';
            document.getElementById('editMenuId').value = '';
            document.getElementById('btnSaveMenu').textContent = 'Simpan Menu';
        }

        function closeMenuModal() {
            document.getElementById('menuModal').classList.remove('show');
        }

        function saveMenu(e) {
            e.preventDefault();
            
            const id = document.getElementById('editMenuId').value;
            const category = document.getElementById('menuCategory').value;
            
            const menuData = {
                id: id || Date.now().toString(),
                name: document.getElementById('menuName').value,
                price: parseInt(document.getElementById('menuPrice').value),
                category: category,
                time: parseInt(document.getElementById('menuTime').value),
                emoji: EMOJIS[category]
            };
            
            if (id) {
                const index = state.menu.findIndex(m => m.id === id);
                if (index !== -1) state.menu[index] = menuData;
            } else {
                state.menu.push(menuData);
            }
            
            // SIMPAN KE FIREBASE (realtime)
            DB.ref('menu').set(state.menu);
            
            closeMenuModal();
            showNotification(id ? '‚úèÔ∏è Menu diupdate!' : '‚úÖ Menu ditambahkan!');
            return false;
        }

        function editMenu(id) {
            const menu = state.menu.find(m => m.id === id);
            if (!menu) return;
            
            document.getElementById('editMenuId').value = menu.id;
            document.getElementById('menuName').value = menu.name;
            document.getElementById('menuPrice').value = menu.price;
            document.getElementById('menuCategory').value = menu.category;
            document.getElementById('menuTime').value = menu.time;
            
            document.getElementById('menuModalTitle').textContent = 'Edit Menu';
            document.getElementById('btnSaveMenu').textContent = 'Update Menu';
            openMenuModal();
        }

        function deleteMenu(id) {
            if (!confirm('Hapus menu ini?')) return;
            state.menu = state.menu.filter(m => m.id !== id);
            DB.ref('menu').set(state.menu);
            showNotification('üóëÔ∏è Menu dihapus');
        }

        function updateOrderStatus(orderId, newStatus) {
            const order = state.orders.find(o => o.id === orderId);
            if (!order) return;
            
            order.status = newStatus;
            DB.ref('orders').set(state.orders);
            showNotification(`‚úÖ Pesanan ${getStatusLabel(newStatus)}`);
        }

        // ==========================================
        // BUYER FUNCTIONS
        // ==========================================
        
        function updateBuyerView() {
            const container = document.getElementById('buyerMenuList');
            
            if (state.menu.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üçΩÔ∏è</div>
                        <div class="empty-title">Menu belum tersedia</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = state.menu.map(menu => {
                const inCart = state.cart.find(c => c.id === menu.id);
                return `
                    <div class="food-card" data-category="${menu.category}">
                        <div class="food-image">${menu.emoji || EMOJIS[menu.category]}</div>
                        <div class="food-info">
                            <div class="food-name">${menu.name}</div>
                            <div class="food-price">Rp ${menu.price.toLocaleString()}</div>
                            ${inCart ? `
                                <div class="quantity-control">
                                    <button class="qty-btn" onclick="updateQty('${menu.id}', -1)">‚àí</button>
                                    <span>${inCart.qty}</span>
                                    <button class="qty-btn" onclick="updateQty('${menu.id}', 1)">+</button>
                                </div>
                            ` : `
                                <button class="add-to-cart" onclick="addToCart('${menu.id}')">üõí Tambah</button>
                            `}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterCategory(cat, el) {
            document.querySelectorAll('.category-pill').forEach(p => p.classList.remove('active'));
            el.classList.add('active');
            
            document.querySelectorAll('.food-card').forEach(card => {
                card.style.display = (cat === 'all' || card.dataset.category === cat) ? 'block' : 'none';
            });
        }

        function searchMenu() {
            const query = document.getElementById('searchFood').value.toLowerCase();
            document.querySelectorAll('.food-card').forEach(card => {
                const name = card.querySelector('.food-name').textContent.toLowerCase();
                card.style.display = name.includes(query) ? 'block' : 'none';
            });
        }

        // ==========================================
        // CART FUNCTIONS
        // ==========================================
        
        function addToCart(menuId) {
            const menu = state.menu.find(m => m.id === menuId);
            if (!menu) return;
            
            const existing = state.cart.find(c => c.id === menuId);
            if (existing) {
                existing.qty++;
            } else {
                state.cart.push({...menu, qty: 1});
            }
            
            updateBuyerView();
            updateCart();
            showNotification('‚úÖ Ditambahkan ke keranjang');
        }

        function updateQty(menuId, change) {
            const item = state.cart.find(c => c.id === menuId);
            if (!item) return;
            
            item.qty += change;
            if (item.qty <= 0) {
                state.cart = state.cart.filter(c => c.id !== menuId);
            }
            
            updateBuyerView();
            updateCart();
        }

        function updateCart() {
            const count = state.cart.reduce((s, i) => s + i.qty, 0);
            const total = state.cart.reduce((s, i) => s + (i.price * i.qty), 0);
            
            document.getElementById('cartItemCount').textContent = count;
            document.getElementById('cartTotal').textContent = total.toLocaleString();
            
            document.getElementById('cartBar').classList.toggle('show', count > 0);
        }

        function openCheckoutModal() {
            const total = state.cart.reduce((s, i) => s + (i.price * i.qty), 0);
            
            document.getElementById('checkoutItems').innerHTML = state.cart.map(i => 
                `<div>${i.emoji || EMOJIS[i.category]} ${i.name} x${i.qty}</div>`
            ).join('');
            
            document.getElementById('checkoutTotal').textContent = total.toLocaleString();
            
            // Tampilkan nomor penjual jika ada
            DB.ref('sellerWA').once('value').then(snap => {
                const wa = snap.val();
                if (wa) {
                    document.getElementById('checkoutSellerWA').textContent = wa;
                    document.getElementById('checkoutSellerInfo').style.display = 'flex';
                }
            });
            
            document.getElementById('checkoutModal').classList.add('show');
        }

        function closeCheckoutModal() {
            document.getElementById('checkoutModal').classList.remove('show');
        }

        function submitOrder(e) {
            e.preventDefault();
            
            const name = document.getElementById('buyerName').value.trim();
            const cls = document.getElementById('buyerClass').value.trim();
            const phone = document.getElementById('buyerPhone').value.trim();
            
            if (!name || !cls || !phone) {
                showNotification('‚ùå Semua field harus diisi!', 'error');
                return false;
            }
            
            // Ambil nomor penjual dari Firebase
            DB.ref('sellerWA').once('value').then(snap => {
                const sellerWA = snap.val();
                
                if (!sellerWA) {
                    showNotification('‚ùå Penjual belum login!', 'error');
                    return;
                }
                
                const total = state.cart.reduce((s, i) => s + (i.price * i.qty), 0);
                const maxTime = Math.max(...state.cart.map(i => i.time));
                
                const order = {
                    id: Date.now().toString(),
                    buyer: name,
                    buyerPhone: phone, // NOMOR PEMBELI - PENTING!
                    class: cls,
                    items: [...state.cart],
                    total: total,
                    status: 'pending',
                    time: new Date().toLocaleString('id-ID'),
                    timestamp: Date.now(),
                    estimateTime: maxTime,
                    sellerWA: sellerWA
                };
                
                state.orders.push(order);
                DB.ref('orders').set(state.orders); // Simpan ke Firebase
                
                // Kirim WhatsApp ke penjual
                const msg = `*PESANAN BARU*\\n\\nNama: ${name}\\nKelas: ${cls}\\nWA: ${phone}\\n\\n${state.cart.map(i => `‚Ä¢ ${i.name} x${i.qty}`).join('\\n')}\\n\\n*Total: Rp ${total.toLocaleString()}*`;
                
                window.open(`https://wa.me/${sellerWA}?text=${encodeURIComponent(msg)}`, '_blank');
                
                closeCheckoutModal();
                showNotification('‚úÖ Pesanan terkirim!');
                state.cart = [];
                updateCart();
            });
            
            return false;
        }

        // ==========================================
        // UTILITIES
        // ==========================================
        
        function getStatusLabel(status) {
            const labels = { pending: 'Menunggu', process: 'Diproses', done: 'Selesai' };
            return labels[status] || status;
        }

        function showNotification(msg, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = msg;
            notif.className = 'notification ' + (type === 'error' ? 'error' : '');
            notif.classList.add('show');
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        function showError(id, msg) {
            const el = document.getElementById(id);
            el.querySelector('span:last-child').textContent = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        // Tutup modal klik outside
        window.onclick = function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('show');
            }
        };

        // ==========================================
        // START
        // ==========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Cek session seller
            const savedWA = localStorage.getItem('sellerWA');
            const loggedIn = localStorage.getItem('sellerLoggedIn');
            
            if (loggedIn === 'true' && savedWA) {
                state.sellerWA = savedWA;
                state.isSellerLoggedIn = true;
            }
            
            // Nyalakan Firebase realtime
            initFirebase();
        });
    </script>
</body>
</html>
